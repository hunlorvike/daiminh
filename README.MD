# Daiminh

Daiminh lÃ  má»™t á»©ng dá»¥ng web .NET 8 thá»ƒ hiá»‡n mÃ´ hÃ¬nh kiáº¿n trÃºc Ä‘a táº§ng.

## Cáº¥u trÃºc Dá»± Ã¡n

Dá»± Ã¡n tuÃ¢n theo cÃ¡ch tiáº¿p cáº­n Clean Architecture / Äa táº§ng tiÃªu chuáº©n:

```text
daiminh/
â”œâ”€â”€ docs/                     # CÃ¡c tá»‡p tÃ i liá»‡u
â”‚   â”œâ”€â”€ DATABASE.MD           # ThÃ´ng tin lÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u
â”‚   â””â”€â”€ database.mermaid      # SÆ¡ Ä‘á»“ Mermaid cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u
â”œâ”€â”€ src/                      # MÃ£ nguá»“n
â”‚   â”œâ”€â”€ application/          # Lá»›p Application: Chá»©a logic nghiá»‡p vá»¥, dá»‹ch vá»¥, use case. Äiá»u phá»‘i cÃ¡c thá»±c thá»ƒ miá»n.
â”‚   â”‚   â”œâ”€â”€ Services/         # CÃ¡c dá»‹ch vá»¥ á»©ng dá»¥ng triá»ƒn khai luá»“ng nghiá»‡p vá»¥
â”‚   â”‚   â””â”€â”€ application.csproj
â”‚   â”œâ”€â”€ domain/               # Lá»›p Domain: CÃ¡c mÃ´ hÃ¬nh, thá»±c thá»ƒ vÃ  quy táº¯c nghiá»‡p vá»¥ cá»‘t lÃµi. Äá»™c láº­p vá»›i cÃ¡c lá»›p khÃ¡c.
â”‚   â”‚   â”œâ”€â”€ Entities/         # CÃ¡c thá»±c thá»ƒ miá»n Ä‘áº¡i diá»‡n cho cÃ¡c khÃ¡i niá»‡m cá»‘t lÃµi
â”‚   â”‚   â””â”€â”€ domain.csproj
â”‚   â”œâ”€â”€ infrastructure/       # Lá»›p Infrastructure: Xá»­ lÃ½ cÃ¡c má»‘i quan tÃ¢m ká»¹ thuáº­t nhÆ° truy cáº­p dá»¯ liá»‡u, tÃ­ch há»£p dá»‹ch vá»¥ bÃªn ngoÃ i.
â”‚   â”‚   â”œâ”€â”€ Migrations/       # CÃ¡c migration cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a Entity Framework Core
â”‚   â”‚   â”œâ”€â”€ Repositories/     # CÃ¡c repository truy cáº­p dá»¯ liá»‡u triá»ƒn khai cÃ¡c interface Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong Application/Domain
â”‚   â”‚   â”œâ”€â”€ UnitOfWork/       # Triá»ƒn khai mÃ´ hÃ¬nh Unit of Work
â”‚   â”‚   â”œâ”€â”€ ApplicationDbContext.cs # DbContext cá»§a EF Core
â”‚   â”‚   â”œâ”€â”€ AuditSaveChangesInterceptor.cs # Interceptor SaveChanges cá»§a EF Core cho viá»‡c kiá»ƒm toÃ¡n
â”‚   â”‚   â””â”€â”€ infrastructure.csproj
â”‚   â”œâ”€â”€ shared/               # Shared Kernel: CÃ¡c má»‘i quan tÃ¢m xuyÃªn suá»‘t, tiá»‡n Ã­ch chung, DTO, enum Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi nhiá»u lá»›p.
â”‚   â”‚   â”œâ”€â”€ Attributes/       # CÃ¡c attribute tÃ¹y chá»‰nh
â”‚   â”‚   â”œâ”€â”€ Constants/        # CÃ¡c háº±ng sá»‘ toÃ n á»©ng dá»¥ng
â”‚   â”‚   â”œâ”€â”€ Enums/            # CÃ¡c Enumeration
â”‚   â”‚   â”œâ”€â”€ Extensions/       # CÃ¡c phÆ°Æ¡ng thá»©c má»Ÿ rá»™ng (extension methods)
â”‚   â”‚   â”œâ”€â”€ Interfaces/       # CÃ¡c interface dÃ¹ng chung
â”‚   â”‚   â”œâ”€â”€ Models/           # CÃ¡c model dÃ¹ng chung (DTO, ViewModel, v.v.)
â”‚   â”‚   â””â”€â”€ shared.csproj
â”‚   â””â”€â”€ web/                  # Lá»›p Presentation: á»¨ng dá»¥ng Web ASP.NET Core xá»­ lÃ½ giao diá»‡n ngÆ°á»i dÃ¹ng vÃ  yÃªu cáº§u API.
â”‚       â”œâ”€â”€ Areas/            # CÃ¡c khu vá»±c chá»©c nÄƒng (vÃ­ dá»¥: Admin, Client)
â”‚       â”œâ”€â”€ Properties/
â”‚       â”œâ”€â”€ wwwroot/          # CÃ¡c tÃ i sáº£n web tÄ©nh (CSS, JavaScript, hÃ¬nh áº£nh)
â”‚       â”œâ”€â”€ appsettings.Development.json
â”‚       â”œâ”€â”€ appsettings.json
â”‚       â”œâ”€â”€ libman.json       # Cáº¥u hÃ¬nh thÆ° viá»‡n phÃ­a client (LibMan)
â”‚       â”œâ”€â”€ Program.cs        # Äiá»ƒm vÃ o á»©ng dá»¥ng vÃ  cáº¥u hÃ¬nh dá»‹ch vá»¥
â”‚       â””â”€â”€ web.csproj
â”œâ”€â”€ .dockerignore            # Chá»‰ Ä‘á»‹nh cÃ¡c tá»‡p/thÆ° má»¥c cáº§n bá» qua trong quÃ¡ trÃ¬nh build Docker
â”œâ”€â”€ .editorconfig           # Äá»‹nh nghÄ©a kiá»ƒu vÃ  Ä‘á»‹nh dáº¡ng code Ä‘á»ƒ Ä‘áº£m báº£o code nháº¥t quÃ¡n
â”œâ”€â”€ .gitignore              # Chá»‰ Ä‘á»‹nh cÃ¡c tá»‡p khÃ´ng Ä‘Æ°á»£c theo dÃµi cá»‘ Ã½ mÃ  Git nÃªn bá» qua
â”œâ”€â”€ daiminh.sln             # Tá»‡p Solution cá»§a Visual Studio
â”œâ”€â”€ docker-compose.yml      # Äá»‹nh nghÄ©a cÃ¡c dá»‹ch vá»¥ á»©ng dá»¥ng Docker Ä‘a container
â”œâ”€â”€ Dockerfile              # HÆ°á»›ng dáº«n Ä‘á»ƒ build image Docker cá»§a á»©ng dá»¥ng
â””â”€â”€ README.MD               # Tá»‡p nÃ y (phiÃªn báº£n tiáº¿ng Viá»‡t)
```

## Äiá»u kiá»‡n tiÃªn quyáº¿t

TrÆ°á»›c khi báº¯t Ä‘áº§u, hÃ£y Ä‘áº£m báº£o báº¡n Ä‘Ã£ cÃ i Ä‘áº·t cÃ¡c cÃ´ng cá»¥ sau:

-   [.NET SDK 8.0](https://dotnet.microsoft.com/download/dotnet/8.0)
-   [Docker](https://www.docker.com/products/docker-desktop/)
-   [Docker Compose](https://docs.docker.com/compose/install/)
-   [Git](https://git-scm.com/downloads)
-   (TÃ¹y chá»n, nhÆ°ng khuyáº¿n nghá»‹) LibMan CLI: `dotnet tool install -g Microsoft.Web.LibraryManager.Cli`
-   (TÃ¹y chá»n, cho EF Migrations) EF Core Tools: `dotnet tool install --global dotnet-ef`

---

## CÃ i Ä‘áº·t MÃ´i trÆ°á»ng PhÃ¡t triá»ƒn Cá»¥c bá»™

### 1. Sao chÃ©p Repository

```bash
git clone https://github.com/hunlorvike/daiminh.git daiminh
cd daiminh
```

### 2. Chá»n PhÆ°Æ¡ng phÃ¡p CÃ i Ä‘áº·t cá»§a Báº¡n

#### **CÃ¡ch 1: Sá»­ dá»¥ng Docker Compose (Khuyáº¿n nghá»‹)**

PhÆ°Æ¡ng phÃ¡p nÃ y sá»­ dá»¥ng Docker Ä‘á»ƒ quáº£n lÃ½ cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  container á»©ng dá»¥ng.

1.  **Khá»Ÿi cháº¡y Dá»‹ch vá»¥:**
    Cháº¡y lá»‡nh sau Ä‘á»ƒ build cÃ¡c image (náº¿u cáº§n) vÃ  khá»Ÿi cháº¡y cÃ¡c container Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `docker-compose.yml` (bao gá»“m cÆ¡ sá»Ÿ dá»¯ liá»‡u PostgreSQL vÃ  á»©ng dá»¥ng web) á»Ÿ cháº¿ Ä‘á»™ detached (cháº¡y ná»n).

    ```bash
    docker compose up -d --build
    ```
    *LÆ°u Ã½: Chá» má»™t lÃ¡t Ä‘á»ƒ container cÆ¡ sá»Ÿ dá»¯ liá»‡u khá»Ÿi táº¡o xong.*

2.  **Ãp dá»¥ng Database Migrations:**
    Cháº¡y lá»‡nh sau tá»« mÃ¡y host cá»§a báº¡n Ä‘á»ƒ Ã¡p dá»¥ng cÃ¡c migration cá»§a Entity Framework vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘ang cháº¡y bÃªn trong container Docker. Lá»‡nh nÃ y nháº¯m vÃ o dá»± Ã¡n `web` Ä‘á»ƒ láº¥y cáº¥u hÃ¬nh (nhÆ° chuá»—i káº¿t ná»‘i) vÃ  dá»± Ã¡n `infrastructure` nÆ¡i chá»©a cÃ¡c migration.

    ```bash
     dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```
    *Äáº£m báº£o chuá»—i káº¿t ná»‘i trong `src/web/appsettings.Development.json` trá» Ä‘Ãºng Ä‘áº¿n dá»‹ch vá»¥ PostgreSQL Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `docker-compose.yml` (vÃ­ dá»¥: `Host=localhost;Port=5432...` náº¿u cá»•ng 5432 Ä‘Æ°á»£c map).*

3.  **Truy cáº­p á»¨ng dá»¥ng:**
    á»¨ng dá»¥ng bÃ¢y giá» sáº½ Ä‘ang cháº¡y. Truy cáº­p nÃ³ qua trÃ¬nh duyá»‡t cá»§a báº¡n, thÆ°á»ng lÃ  táº¡i `http://localhost:8080` (hoáº·c cá»•ng Ä‘Æ°á»£c map trong `docker-compose.yml` cho dá»‹ch vá»¥ `api`).

4.  **Xem Logs (TÃ¹y chá»n):**
    ```bash
    docker compose logs -f
    ```

5.  **Dá»«ng Dá»‹ch vá»¥:**
    ```bash
    docker compose down
    ```

---

#### **CÃ¡ch 2: Cháº¡y Thá»§ cÃ´ng khÃ´ng cáº§n Docker**

PhÆ°Æ¡ng phÃ¡p nÃ y yÃªu cáº§u báº¡n pháº£i cÃ³ má»™t instance PostgreSQL Ä‘ang cháº¡y cá»¥c bá»™.

1.  **Cáº¥u hÃ¬nh CÆ¡ sá»Ÿ dá»¯ liá»‡u:**
    -   Äáº£m báº£o báº¡n Ä‘Ã£ cÃ i Ä‘áº·t vÃ  Ä‘ang cháº¡y PostgreSQL cá»¥c bá»™.
    -   Cáº­p nháº­t má»¥c `ConnectionStrings` trong `src/web/appsettings.Development.json` Ä‘á»ƒ trá» Ä‘áº¿n instance PostgreSQL cá»¥c bá»™ cá»§a báº¡n.

2.  **Ãp dá»¥ng Database Migrations:**
    Cháº¡y lá»‡nh sau Ä‘á»ƒ táº¡o hoáº·c cáº­p nháº­t lÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u:
    ```bash
    dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

3.  **Build vÃ  Cháº¡y á»¨ng dá»¥ng:**
    Thá»±c thi cÃ¡c lá»‡nh sau Ä‘á»ƒ khÃ´i phá»¥c cÃ¡c dependency, build vÃ  cháº¡y á»©ng dá»¥ng web:

    ```bash
    # KhÃ´i phá»¥c cÃ¡c gÃ³i NuGet cho solution
    dotnet restore daiminh.sln

    # KhÃ´i phá»¥c cÃ¡c thÆ° viá»‡n phÃ­a client Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong libman.json
    libman restore

    # Build solution
    dotnet build daiminh.sln --no-restore

    # Cháº¡y á»©ng dá»¥ng web
    dotnet run --project ./src/web/web.csproj --no-build
    ```

4.  **Truy cáº­p á»¨ng dá»¥ng:**
    á»¨ng dá»¥ng bÃ¢y giá» sáº½ Ä‘ang cháº¡y. Truy cáº­p nÃ³ qua trÃ¬nh duyá»‡t cá»§a báº¡n, thÆ°á»ng lÃ  táº¡i `https://localhost:7001` hoáº·c `http://localhost:5001` (kiá»ƒm tra output cá»§a console Ä‘á»ƒ biáº¿t URL chÃ­nh xÃ¡c).

---

## Quáº£n lÃ½ ThÆ° viá»‡n PhÃ­a Client (LibMan)

Dá»± Ã¡n nÃ y sá»­ dá»¥ng LibMan (`libman.json`) Ä‘á»ƒ quáº£n lÃ½ cÃ¡c thÆ° viá»‡n front-end (JavaScript, CSS). CÃ¡c thÆ° viá»‡n nÃ y Ä‘Æ°á»£c khÃ´i phá»¥c vÃ o thÆ° má»¥c `wwwroot`.

-   **KhÃ´i phá»¥c ThÆ° viá»‡n:** (Táº£i xuá»‘ng/cÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n nhÆ° Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `libman.json`)
    ```bash
    libman restore
    ```
    *ThÆ°á»ng Ä‘Æ°á»£c thá»±c hiá»‡n má»™t láº§n sau khi clone hoáº·c pull cÃ¡c thay Ä‘á»•i, hoáº·c sau khi sá»­a Ä‘á»•i `libman.json`. Lá»‡nh `dotnet restore` cÅ©ng cÃ³ thá»ƒ kÃ­ch hoáº¡t hÃ nh Ä‘á»™ng nÃ y náº¿u Ä‘Æ°á»£c cáº¥u hÃ¬nh.*

-   **Dá»n dáº¹p ThÆ° viá»‡n:** (XÃ³a cÃ¡c thÆ° viá»‡n do LibMan cÃ i Ä‘áº·t khá»i `wwwroot`)
    ```bash
    libman clean
    ```

-   **Cáº­p nháº­t ThÆ° viá»‡n:** (Cáº­p nháº­t má»™t thÆ° viá»‡n cá»¥ thá»ƒ lÃªn phiÃªn báº£n má»›i nháº¥t Ä‘Æ°á»£c phÃ©p)
    ```bash
    libman update <tÃªn-thÆ°-viá»‡n>
    ```
    *(VÃ­ dá»¥: `libman update jquery`)*

-   **CÃ i Ä‘áº·t ThÆ° viá»‡n Má»›i:**
    Sá»­ dá»¥ng LibMan CLI hoáº·c chá»‰nh sá»­a trá»±c tiáº¿p `libman.json`.
    ```bash
    # VÃ­ dá»¥: CÃ i Ä‘áº·t Bootstrap 5.3.3 tá»« jsDelivr
    libman install bootstrap@5.3.3 -p jsdelivr -d wwwroot/lib/bootstrap --files css/bootstrap.min.css,js/bootstrap.bundle.min.js
    ```
    Sau khi cÃ i Ä‘áº·t qua CLI hoáº·c chá»‰nh sá»­a `libman.json`, cháº¡y `libman restore`.

---

## Entity Framework Core Migrations

Náº¿u báº¡n thá»±c hiá»‡n cÃ¡c thay Ä‘á»•i Ä‘á»‘i vá»›i cÃ¡c thá»±c thá»ƒ miá»n hoáº·c `ApplicationDbContext`:

1.  **ThÃªm má»™t Migration:**
    Táº¡o má»™t tá»‡p migration má»›i ghi láº¡i cÃ¡c thay Ä‘á»•i.
    ```bash
    dotnet ef migrations add <TÃªnMigrationCá»§aBáº¡n> --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

2.  **Ãp dá»¥ng Migration:**
    Ãp dá»¥ng cÃ¡c migration Ä‘ang chá» xá»­ lÃ½ vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u.
    ```bash
    dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

3.  **XÃ³a Migration Cuá»‘i cÃ¹ng (náº¿u cáº§n):**
    ```bash
    dotnet ef migrations remove --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

---

## EditorConfig

Dá»± Ã¡n nÃ y bao gá»“m má»™t tá»‡p `.editorconfig` Ä‘á»ƒ giÃºp duy trÃ¬ cÃ¡c kiá»ƒu code nháº¥t quÃ¡n. Vui lÃ²ng cáº¥u hÃ¬nh IDE cá»§a báº¡n (Visual Studio, VS Code, Rider) Ä‘á»ƒ tuÃ¢n thá»§ cÃ¡c cÃ i Ä‘áº·t `.editorconfig`. Äiá»u nÃ y thÆ°á»ng bao gá»“m:

-   XÃ³a cÃ¡c cÃ¢u lá»‡nh `using` khÃ´ng cáº§n thiáº¿t.
-   Äáº£m báº£o namespace khá»›p vá»›i cáº¥u trÃºc thÆ° má»¥c.
-   Ãp dá»¥ng cÃ¡c quy táº¯c Ä‘á»‹nh dáº¡ng code.
-   Sáº¯p xáº¿p cÃ¡c cÃ¢u lá»‡nh `using`.
-   Sá»­a cÃ¡c cáº£nh bÃ¡o/lá»—i cá»§a analyzer Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong tá»‡p.

---

ChÃºc báº¡n coding vui váº»! ğŸš€
