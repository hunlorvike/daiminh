# Daiminh

A .NET 8 web application with a multi-layer architecture.

## Project Structure

```text
daiminh/
â”œâ”€â”€ docs/                     # Documentation files
â”‚   â”œâ”€â”€ DATABASE.MD           # Database schema information
â”‚   â””â”€â”€ database.mermaid      # Mermaid diagram of the database
â”œâ”€â”€ src/                      # Source code
â”‚   â”œâ”€â”€ application/          # Application layer (business logic, services)
â”‚   â”‚   â”œâ”€â”€ Services/         # Application services
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ CategoryService.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ... (other services)
â”‚   â”‚   â”‚   â””â”€â”€ UserService.cs
â”‚   â”‚   â””â”€â”€ application.csproj
â”‚   â”œâ”€â”€ domain/               # Domain layer (entities, core business rules)
â”‚   â”‚   â”œâ”€â”€ Entities/         # Domain entities
â”‚   â”‚   â”‚   â”œâ”€â”€ Shared/       # Shared entities
â”‚   â”‚   â”‚   â”œâ”€â”€ Category.cs
â”‚   â”‚   â”‚   â”œâ”€â”€ ... (other entities)
â”‚   â”‚   â”‚   â””â”€â”€ User.cs
â”‚   â”œâ”€â”€ infrastructure/       # Infrastructure layer (data access, external services)
â”‚   â”‚   â”œâ”€â”€ Migrations/       # Database migrations
â”‚   â”‚   â”œâ”€â”€ Repositories/     # Data repositories
â”‚   â”‚   â”œâ”€â”€ UnitOfWork/       # Unit of Work implementation
â”‚   â”‚   â”œâ”€â”€ ApplicationDbContext.cs
â”‚   â”‚   â”œâ”€â”€ AuditSaveChangesInterceptor.cs
â”‚   â”‚   â””â”€â”€ infrastructure.csproj
â”‚   â”œâ”€â”€ shared/               # Shared components, utilities, and models
â”‚   â”‚   â”œâ”€â”€ Attributes/       # Custom attributes
â”‚   â”‚   â”œâ”€â”€ Constants/        # Constants
â”‚   â”‚   â”œâ”€â”€ Enums/            # Enumerations
â”‚   â”‚   â”œâ”€â”€ Extensions/       # Extension methods
â”‚   â”‚   â”œâ”€â”€ Interfaces/       # Shared interfaces
â”‚   â”‚   â”œâ”€â”€ Models/           # Shared models (e.g., DTOs, ViewModels)
â”‚   â”‚   â””â”€â”€ shared.csproj
â”‚   â””â”€â”€ web/                  # Presentation layer (ASP.NET Core Web App)
â”‚       â”œâ”€â”€ Areas/            # Areas (e.g., Admin, Client)
â”‚       â”‚   â”œâ”€â”€ Admin/        # Admin area
â”‚       â”‚   â”‚   â”œâ”€â”€ Controllers/
â”‚       â”‚   â”‚   â”œâ”€â”€ Models/
â”‚       â”‚   â”‚   â”œâ”€â”€ Profiles/      # AutoMapper Profiles
â”‚       â”‚   â”‚   â”œâ”€â”€ Requests/      # Request Models
â”‚       â”‚   â”‚   â””â”€â”€ Views/
â”‚       â”‚   â””â”€â”€ Client/       # Client area
â”‚       â”‚       â”œâ”€â”€ Controllers/
â”‚       â”‚       â”œâ”€â”€ Models/
â”‚       â”‚       â”œâ”€â”€ Profiles/      # AutoMapper Profiles
â”‚       â”‚       â”œâ”€â”€ Requests/      # Request Models
â”‚       â”‚       â””â”€â”€ Views/
â”‚       â”œâ”€â”€ Properties/
â”‚       â”œâ”€â”€ wwwroot/          # Static files (CSS, JavaScript, images)
â”‚       â”œâ”€â”€ appsettings.Development.json
â”‚       â”œâ”€â”€ appsettings.json
â”‚       â”œâ”€â”€ Program.cs
â”‚       â””â”€â”€ web.csproj
â”œâ”€â”€ .dockerignore            # Files/folders to ignore in Docker builds
â”œâ”€â”€ .editorconfig           # Editor configuration
â”œâ”€â”€ .gitignore              # Files/folders to ignore in Git
â”œâ”€â”€ daiminh.sln             # Solution file
â”œâ”€â”€ docker-compose.yml      # Docker Compose configuration
â”œâ”€â”€ Dockerfile              # Dockerfile for building the application image
â”œâ”€â”€ libman.json             # LibMan configuration file (for client-side libraries)
â””â”€â”€ README.MD               # This file
```

## Prerequisites

Before you begin, ensure you have the following installed:

-   [.NET SDK 8.0](https://dotnet.microsoft.com/download/dotnet/8.0)
-   [Docker](https://www.docker.com/products/docker-desktop/)
-   [Docker Compose](https://docs.docker.com/compose/install/)
-   (Optional, but recommended) LibMan CLI:  `dotnet tool install -g Microsoft.Web.LibraryManager.Cli`

---

## Local Development Setup

### 1. Clone the Repository

```bash
git clone https://github.com/hunlorvike/daiminh.git daiminh
cd daiminh
```

### 2. Setup and Run the Project

#### **Option 1: Using Docker Compose (Recommended)**

1.  **Start the Services (database, application, etc.)**
    Run the following command to start all necessary containers:

    ```bash
    docker compose up -d
    ```

2.  **Apply Database Migrations**
    Run the following command to update the database:

    ```bash
     dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

3. **Clean, Restore, Build, and Run**

   ```bash
   dotnet clean daiminh.sln
   dotnet restore daiminh.sln
   dotnet build daiminh.sln
   libman clean  # Clean client-side libraries
   libman restore # Restore client-side libraries
   dotnet run --project ./src/web/web.csproj
   ```

---

#### **Option 2: Running Manually without Docker**

If you don't want to use Docker, you can run the project manually:

1.  **Configure the Database**
    -   Ensure you have PostgreSQL installed.
    -   Update the connection string in `src/web/appsettings.json`.

2.  **Apply Database Migrations**
    ```bash
    dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

3. **Clean, Restore, Build, and Run**

   ```bash
    dotnet clean daiminh.sln       # Clean the solution
    dotnet restore daiminh.sln    # Restore NuGet packages
    dotnet build daiminh.sln       # Build the solution
    libman clean                  # Clean client-side libraries
    libman restore                # Restore client-side libraries (using libman.json)
    dotnet run --project ./src/web/web.csproj
   ```

---

##  Managing Client-Side Libraries (LibMan)

This project uses LibMan to manage client-side libraries (JavaScript, CSS, etc.).  The `libman.json` file at the root of the project defines these libraries.

- **Restore Libraries:**
  ```bash
  libman restore
  ```
  This command downloads and installs the libraries specified in `libman.json` into the `wwwroot` folder.

- **Clean Libraries:**
  ```bash
  libman clean
  ```
  This command removes all library files managed by LibMan from the `wwwroot` folder.  It's a good practice to run this before restoring to ensure you have a clean slate.

- **Update a Specific Library:**
  ```bash
  libman update <library-name>
  ```
  This command updates a specific library to the latest version (or the version specified in `libman.json`).

- **Install a New Library:**
    -  You can use the LibMan CLI:
        ```bash
        libman install <library-name>@<version> -p <provider> -d <destination>
        ```
        (e.g., `libman install jquery@3.7.1 -p unpkg -d wwwroot/lib/jquery`)
    -  Or, you can directly edit the `libman.json` file and then run `libman restore`.  Visual Studio also provides a GUI for managing LibMan.

**Important:** Always run `libman restore` after cloning the repository, pulling changes, or modifying `libman.json`.  This ensures your `wwwroot` folder contains the correct library files.

---

## Notes

-   If you encounter errors related to Entity Framework, ensure you have the `dotnet-ef` tool installed globally:

    ```bash
    dotnet tool install --global dotnet-ef
    ```

-   If you make changes to the migrations, run the following commands:

    ```bash
    dotnet ef migrations add <MigrationName> --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    dotnet ef database update --project ./src/infrastructure/infrastructure.csproj --startup-project ./src/web/web.csproj
    ```

Happy coding! ðŸš€
