@model web.Areas.Client.Models.Content.ContentDetailViewModel
@{
	ViewData["Title"] = Model.Content.Title;
}

<div class="page-header d-print-none">
	<div class="container-xl">
		<div class="row g-2 align-items-center">
			<div class="col">
				<div class="page-pretitle">
					@if (Model.Content.ContentCategories != null && Model.Content.ContentCategories.Any())
					{
						var category = Model.Content.ContentCategories.FirstOrDefault()?.Category;
						if (category != null)
						{
							<a href="@Url.Action("Index", new { category = category.Slug })" class="text-muted">
								@category.Name
							</a>
						}
					}
					else
					{
						<span>Bài viết</span>
					}
				</div>
				<h2 class="page-title">@Model.Content.Title</h2>
			</div>
			<div class="col-auto ms-auto">
				<div class="btn-list">
					<a href="@Url.Action("Index")" class="btn btn-outline-primary d-none d-sm-inline-block">
						<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
							<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
							<path d="M5 12l14 0"></path>
							<path d="M5 12l6 6"></path>
							<path d="M5 12l6 -6"></path>
						</svg>
						Quay lại danh sách
					</a>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="page-body">
	<div class="container-xl">
		<div class="row g-4">
			<div class="col-lg-8">
				<div class="card">
					<div class="card-body">
						<div class="d-flex align-items-center mb-4">
							<span class="avatar avatar-md me-3" style="background-image: url('/img/icon.jpg');"></span>
							<div>
								<div>@((Model.Content?.Author?.Email) ?? "Đại Minh")</div>
								<div class="text-muted">
									<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar me-1" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
										<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
										<path d="M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z"></path>
										<path d="M16 3v4"></path>
										<path d="M8 3v4"></path>
										<path d="M4 11h16"></path>
										<path d="M11 15h1"></path>
										<path d="M12 15v3"></path>
									</svg>
									@Model.Content.CreatedAt.ToString("dd/MM/yyyy")
								</div>
							</div>
							<div class="ms-auto">
								@if (Model.Content.ContentTags != null && Model.Content.ContentTags.Any())
								{
									<div class="d-flex flex-wrap gap-2">
										@foreach (var contentTag in Model.Content.ContentTags)
										{
											if (contentTag.Tag != null)
											{
												<a href="@Url.Action("Index", new { tag = contentTag.Tag.Slug })" class="badge bg-azure-lt">
													#@contentTag.Tag.Slug
												</a>
											}
										}
									</div>
								}
							</div>
						</div>

						@if (!string.IsNullOrEmpty(Model.Content.CoverImageUrl))
						{
							<div class="mb-4">
								<img src="@Model.Content.CoverImageUrl" class="img-fluid rounded" alt="@Model.Content.Title">
							</div>
						}

						<div class="markdown">
							@Html.Raw(Model.Content.ContentBody)
						</div>

						<div class="mt-5 pt-4 border-top">
							<div class="d-flex align-items-center">
								<div class="me-auto">
									<h3 class="mb-0">Chia sẻ bài viết</h3>
								</div>
								<div class="d-flex gap-2">
									<a href="javascript:void(0)" class="btn btn-facebook btn-icon" aria-label="Facebook">
										<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
											<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
											<path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3"></path>
										</svg>
									</a>
									<a href="javascript:void(0)" class="btn btn-twitter btn-icon" aria-label="Twitter">
										<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
											<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
											<path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c0 -.249 1.51 -2.772 1.818 -4.013z"></path>
										</svg>
									</a>
									<a href="javascript:void(0)" class="btn btn-linkedin btn-icon" aria-label="LinkedIn">
										<svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
											<path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
											<path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path>
											<path d="M8 11l0 5"></path>
											<path d="M8 8l0 .01"></path>
											<path d="M12 16l0 -5"></path>
											<path d="M16 16v-3a2 2 0 0 0 -4 0"></path>
										</svg>
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>

				@if (Model.RelatedContents.Any())
				{
					<div class="card mt-4">
						<div class="card-header">
							<h3 class="card-title">Bài viết liên quan</h3>
						</div>
						<div class="card-body">
							<div class="row row-cards">
								@foreach (var relatedContent in Model.RelatedContents)
								{
									<div class="col-md-6">
										<div class="card card-sm">
											<a href="@Url.Action("Detail", new { slug = relatedContent.Slug })" class="d-block">
												<img src="@relatedContent.CoverImageUrl" class="card-img-top" alt="@relatedContent.Title">
											</a>
											<div class="card-body">
												<h3 class="card-title">
													<a href="@Url.Action("Detail", new { slug = relatedContent.Slug })">@relatedContent.Title</a>
												</h3>
												<div class="text-muted">@relatedContent.CreatedAt.ToString("dd/MM/yyyy")</div>
											</div>
										</div>
									</div>
								}
							</div>
						</div>
					</div>
				}
			</div>

			<div class="col-lg-4">
				<div class="card mb-4">
					<div class="card-header">
						<h3 class="card-title">Chủ đề</h3>
					</div>
					<div class="list-group list-group-flush">
						<a href="@Url.Action("Index")" class="list-group-item list-group-item-action d-flex align-items-center">
							<span class="avatar avatar-xs bg-primary-lt me-3">T</span>
							<div class="flex-fill">Tất cả bài viết</div>
						</a>
						@if (Model.Content.ContentCategories != null)
						{
							foreach (var contentCategory in Model.Content.ContentCategories)
							{
								if (contentCategory.Category != null)
								{
									<a href="@Url.Action("Index", new { category = contentCategory.Category.Slug })"
									   class="list-group-item list-group-item-action d-flex align-items-center active">
										<span class="avatar avatar-xs bg-primary-lt me-3">
											@(contentCategory.Category.Name.Length > 0 ? contentCategory.Category.Name[0] : 'C')
										</span>
										<div class="flex-fill">@contentCategory.Category.Name</div>
									</a>
								}
							}
						}
					</div>
				</div>

				@if (Model.RelatedContents.Any())
				{
					<div class="card mb-4">
						<div class="card-header">
							<h3 class="card-title">Bài viết cùng chủ đề</h3>
						</div>
						<div class="list-group list-group-flush">
							@foreach (var relatedContent in Model.RelatedContents)
							{
								<a href="@Url.Action("Detail", new { slug = relatedContent.Slug })" class="list-group-item list-group-item-action">
									<div class="row align-items-center">
										<div class="col-auto">
											<span class="avatar" style="background-image: url('@relatedContent.CoverImageUrl')"></span>
										</div>
										<div class="col">
											<div class="text-truncate">@relatedContent.Title</div>
											<div class="text-muted">@relatedContent.CreatedAt.ToString("dd/MM/yyyy")</div>
										</div>
									</div>
								</a>
							}
						</div>
					</div>
				}
			</div>
		</div>
	</div>
</div>

@section FootScripts {
	<script>
		$(document).ready(function () {
			const pageUrl = encodeURIComponent(window.location.href);
			const pageTitle = encodeURIComponent(document.title);

			$('.btn-facebook, .btn-twitter, .btn-linkedin').on('click', function (e) {
				e.preventDefault();
				let shareUrl = '';

				if ($(this).hasClass('btn-facebook')) {
					shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${pageUrl}`;
				} else if ($(this).hasClass('btn-twitter')) {
					shareUrl = `https://twitter.com/intent/tweet?url=${pageUrl}&text=${pageTitle}`;
				} else if ($(this).hasClass('btn-linkedin')) {
					shareUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${pageUrl}`;
				}

				if (shareUrl) {
					window.open(shareUrl, '_blank', 'width=600,height=400');
				}
			});
		});
	</script>
}