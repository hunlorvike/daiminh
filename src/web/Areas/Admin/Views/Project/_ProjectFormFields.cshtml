@using shared.Helpers;
@using web.Areas.Admin.ViewModels.Project;
@model ProjectViewModel;
@using shared.Enums;
@using shared.Extensions;

@* --- TABS --- *@
<ul class="nav nav-tabs nav-fill mb-3" data-bs-toggle="tabs" role="tablist">
    <li class="nav-item" role="presentation"><a href="#project-tab-basic" class="nav-link active" data-bs-toggle="tab" aria-selected="true" role="tab"><i class="ti ti-info-circle me-2"></i> Thông tin cơ bản</a></li>
    <li class="nav-item" role="presentation"><a href="#project-tab-details" class="nav-link" data-bs-toggle="tab" aria-selected="false" role="tab" tabindex="-1"><i class="ti ti-building-community me-2"></i> Chi tiết dự án</a></li>
    <li class="nav-item" role="presentation"><a href="#project-tab-images" class="nav-link" data-bs-toggle="tab" aria-selected="false" role="tab" tabindex="-1"><i class="ti ti-photo me-2"></i> Hình ảnh</a></li>
    <li class="nav-item" role="presentation"><a href="#project-tab-relations" class="nav-link" data-bs-toggle="tab" aria-selected="false" role="tab" tabindex="-1"><i class="ti ti-tags me-2"></i> Phân loại & SP</a></li>
    <li class="nav-item" role="presentation"><a href="#project-tab-seo" class="nav-link" data-bs-toggle="tab" aria-selected="false" role="tab" tabindex="-1"><i class="ti ti-search me-2"></i> Tối ưu SEO</a></li>
</ul>

@* --- TAB CONTENT --- *@
<div class="tab-content">
    @* --- Tab: Basic Info --- *@
    <div class="tab-pane active show" id="project-tab-basic" role="tabpanel">
        <div class="row">
            <div class="col-md-8">
                <div class="mb-3"><label asp-for="Name" class="form-label required"></label><input asp-for="Name" class="form-control form-control-lg" id="projectName" /><span asp-validation-for="Name" class="text-danger"></span></div>
                <div class="mb-3"><label asp-for="Slug" class="form-label required"></label><div class="input-group"><input asp-for="Slug" class="form-control" id="projectSlug" /><button class="btn btn-outline-secondary" type="button" id="generateSlugButton"><i class="ti ti-refresh"></i></button></div><span asp-validation-for="Slug" class="text-danger"></span></div>
                <div class="mb-3"><label asp-for="ShortDescription" class="form-label"></label><textarea asp-for="ShortDescription" class="form-control" rows="4"></textarea><span asp-validation-for="ShortDescription" class="text-danger"></span></div>
            </div>
            <div class="col-md-4">
                <div class="mb-3"><label asp-for="Client" class="form-label"></label><input asp-for="Client" class="form-control" /><span asp-validation-for="Client" class="text-danger"></span></div>
                <div class="mb-3"><label asp-for="Location" class="form-label"></label><input asp-for="Location" class="form-control" /><span asp-validation-for="Location" class="text-danger"></span></div>
                <div class="mb-3"><label asp-for="Area" class="form-label"></label><input type="number" step="0.01" asp-for="Area" class="form-control" /><span asp-validation-for="Area" class="text-danger"></span></div>
                <div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" asp-for="IsFeatured" role="switch" id="IsFeatured"><label class="form-check-label" asp-for="IsFeatured"></label><span asp-validation-for="IsFeatured" class="text-danger"></span></div>
            </div>
        </div>
    </div>

    @* --- Tab: Details --- *@
    <div class="tab-pane" id="project-tab-details" role="tabpanel">
        <div class="mb-3"><label asp-for="Description" class="form-label required"></label><textarea asp-for="Description" class="form-control summernote-editor" id="projectDescriptionEditor" rows="15"></textarea><span asp-validation-for="Description" class="text-danger"></span></div>
        <div class="row">
            <div class="col-md-6"><div class="mb-3"><label asp-for="StartDate" class="form-label"></label><input asp-for="StartDate" type="date" class="form-control" /><span asp-validation-for="StartDate" class="text-danger"></span></div></div>
            <div class="col-md-6"><div class="mb-3"><label asp-for="CompletionDate" class="form-label"></label><input asp-for="CompletionDate" type="date" class="form-control" /><span asp-validation-for="CompletionDate" class="text-danger"></span></div></div>
        </div>
        <div class="row">
            <div class="col-md-6"><div class="mb-3"><label asp-for="Status" class="form-label required"></label><select asp-for="Status" asp-items="@Model.StatusList" class="form-select tom-select-single"></select><span asp-validation-for="Status" class="text-danger"></span></div></div>
            <div class="col-md-6"><div class="mb-3"><label asp-for="PublishStatus" class="form-label required"></label><select asp-for="PublishStatus" asp-items="@Model.PublishStatusList" class="form-select tom-select-single"></select><span asp-validation-for="PublishStatus" class="text-danger"></span></div></div>
        </div>
    </div>

    @* --- Tab: Images --- *@
    <div class="tab-pane" id="project-tab-images" role="tabpanel">
        <div class="row">
            <div class="col-md-6">
                <h4 class="mb-3">Hình ảnh chính</h4>
                <div class="form-group mb-3" id="featured-image-area">
                    @* Featured Image *@
                    <label asp-for="FeaturedImage" class="form-label">Ảnh Featured</label>
                    <div><img id="featuredImagePreview" src="@MediaUrlHelper.GetMinioUrl(Model.FeaturedImage, "/img/placeholder.svg")" class="img-thumbnail mb-2" style="max-height: 150px;" /></div>
                    <input type="hidden" asp-for="FeaturedImage" id="featuredImagePathInput" />
                    <div><button type="button" class="btn btn-sm btn-outline-primary select-media-btn" data-target-input="#featuredImagePathInput" data-target-preview="#featuredImagePreview"><i class="ti ti-photo-search me-1"></i> Chọn</button><button type="button" class="btn btn-sm btn-outline-danger remove-media-btn ms-2 @(string.IsNullOrEmpty(Model.FeaturedImage) ? "d-none" : "")" data-target-input="#featuredImagePathInput" data-target-preview="#featuredImagePreview" data-placeholder="/img/placeholder.svg"><i class="ti ti-x me-1"></i> Xóa</button></div>
                    <span asp-validation-for="FeaturedImage" class="text-danger"></span>
                </div>
                <div class="form-group mb-3" id="thumbnail-image-area">
                    @* Thumbnail Image *@
                    <label asp-for="ThumbnailImage" class="form-label">Ảnh Thumbnail</label>
                    <div><img id="thumbnailImagePreview" src="@MediaUrlHelper.GetMinioUrl(Model.ThumbnailImage, "/img/placeholder.svg")" class="img-thumbnail mb-2" style="max-height: 100px;" /></div>
                    <input type="hidden" asp-for="ThumbnailImage" id="thumbnailImagePathInput" />
                    <div><button type="button" class="btn btn-sm btn-outline-primary select-media-btn" data-target-input="#thumbnailImagePathInput" data-target-preview="#thumbnailImagePreview"><i class="ti ti-photo-search me-1"></i> Chọn</button><button type="button" class="btn btn-sm btn-outline-danger remove-media-btn ms-2 @(string.IsNullOrEmpty(Model.ThumbnailImage) ? "d-none" : "")" data-target-input="#thumbnailImagePathInput" data-target-preview="#thumbnailImagePreview" data-placeholder="/img/placeholder.svg"><i class="ti ti-x me-1"></i> Xóa</button></div>
                    <span asp-validation-for="ThumbnailImage" class="text-danger"></span>
                    <small class="form-hint">Nếu trống sẽ dùng ảnh Featured.</small>
                </div>
            </div>
            <div class="col-md-6">
                <h4 class="mb-3">Bộ sưu tập ảnh dự án</h4>
                <div class="d-flex justify-content-end mb-3">
                    <button type="button" class="btn btn-outline-primary" id="selectProjectImagesBtn"> <i class="ti ti-photo-plus me-2"></i> Chọn ảnh bộ sưu tập </button>
                </div>
                <span asp-validation-for="Images" class="text-danger d-block mb-2"></span>
            </div>
        </div>
        <div id="project-image-list" class="row g-3 border-top pt-3 mt-3">
            @* Gallery Images List *@
            @for (int i = 0; i < Model.Images.Count; i++)
            {
                var imgId = $"p_image_{i}";
                <div class="col-md-6 col-lg-4 project-image-item" data-index="@i" data-image-path="@Model.Images[i].ImageUrl">
                    <input type="hidden" asp-for="Images[i].Id" /><input type="hidden" asp-for="Images[i].ImageUrl" class="image-url-input" /><input type="hidden" asp-for="Images[i].ThumbnailUrl" class="thumb-url-input" /><input type="hidden" asp-for="Images[i].IsDeleted" class="is-deleted-input" value="false" />
                    <div class="card">
                        <div class="img-responsive img-responsive-16x9 card-img-top image-preview" style="background-image: url(@MediaUrlHelper.GetMinioUrl(Model.Images[i].ThumbnailUrl ?? Model.Images[i].ImageUrl, "/img/placeholder.svg"))"></div>
                        <div class="card-body">
                            <div class="mb-2"><label asp-for="Images[i].AltText" class="form-label form-label-sm"></label><input asp-for="Images[i].AltText" class="form-control form-control-sm" id="@($"{imgId}_AltText")" /><span asp-validation-for="Images[i].AltText" class="text-danger"></span></div>
                            <div class="mb-2"><label asp-for="Images[i].Title" class="form-label form-label-sm"></label><input asp-for="Images[i].Title" class="form-control form-control-sm" id="@($"{imgId}_Title")" /><span asp-validation-for="Images[i].Title" class="text-danger"></span></div>
                            <div class="mb-2"><label asp-for="Images[i].Description" class="form-label form-label-sm"></label><textarea asp-for="Images[i].Description" class="form-control form-control-sm" rows="2" id="@($"{imgId}_Description")"></textarea><span asp-validation-for="Images[i].Description" class="text-danger"></span></div>
                            <div class="row g-2 align-items-center">
                                <div class="col"><div class="form-check form-switch"><input class="form-check-input is-main-gallery-input" type="radio" name="ProjectImagesMainRadio" id="@($"{imgId}_IsMain")" value="@i" checked="@Model.Images[i].IsMain"><input type="hidden" asp-for="Images[i].IsMain" class="is-main-hidden" /><label class="form-check-label form-label-sm" asp-for="Images[i].IsMain" for="@($"{imgId}_IsMain")"></label></div></div>
                                <div class="col-auto"><input type="number" asp-for="Images[i].OrderIndex" class="form-control form-control-sm order-index-input" style="width: 60px;" title="Thứ tự" min="0" id="@($"{imgId}_OrderIndex")" /><span asp-validation-for="Images[i].OrderIndex" class="text-danger"></span></div>
                                <div class="col-auto"><button type="button" class="btn btn-sm btn-outline-danger remove-image-btn" title="Gỡ ảnh"><i class="ti ti-trash"></i></button></div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
        @* Template for NEW gallery images *@
        <template id="project-image-template">
            <div class="col-md-6 col-lg-4 project-image-item" data-index="__INDEX__" data-image-path="__IMAGE_PATH__">
                <input type="hidden" name="Images[__INDEX__].Id" value="0" /><input type="hidden" name="Images[__INDEX__].ImageUrl" class="image-url-input" value="__IMAGE_PATH__" /><input type="hidden" name="Images[__INDEX__].ThumbnailUrl" class="thumb-url-input" value="__THUMB_PATH__" /><input type="hidden" name="Images[__INDEX__].IsDeleted" class="is-deleted-input" value="false" />
                <div class="card">
                    <div class="img-responsive img-responsive-16x9 card-img-top image-preview" style="background-image: url(__DISPLAY_URL__)"></div>
                    <div class="card-body">
                        <div class="mb-2"><label name="Images[__INDEX__].AltText" class="form-label form-label-sm">Alt Text</label><input name="Images[__INDEX__].AltText" class="form-control form-control-sm" id="Images___INDEX___AltText" value="__ALT_TEXT__" /></div>
                        <div class="mb-2"><label name="Images[__INDEX__].Title" class="form-label form-label-sm">Title</label><input name="Images[__INDEX__].Title" class="form-control form-control-sm" id="Images___INDEX___Title" /></div>
                        <div class="mb-2"><label name="Images[__INDEX__].Description" class="form-label form-label-sm">Mô tả ảnh</label><textarea name="Images[__INDEX__].Description" class="form-control form-control-sm" rows="2" id="Images___INDEX___Description"></textarea></div>
                        <div class="row g-2 align-items-center">
                            <div class="col"><div class="form-check form-switch"><input class="form-check-input is-main-gallery-input" type="radio" name="ProjectImagesMainRadio" id="Images___INDEX___IsMain" value="__INDEX__"><input type="hidden" name="Images[__INDEX__].IsMain" class="is-main-hidden" value="false" /><label class="form-check-label form-label-sm" for="Images___INDEX___IsMain">Ảnh chính</label></div></div>
                            <div class="col-auto"><input type="number" name="Images[__INDEX__].OrderIndex" class="form-control form-control-sm order-index-input" value="0" style="width: 60px;" title="Thứ tự" min="0" id="Images___INDEX___OrderIndex" /></div>
                            <div class="col-auto"><button type="button" class="btn btn-sm btn-outline-danger remove-image-btn" title="Gỡ ảnh"><i class="ti ti-trash"></i></button></div>
                        </div>
                    </div>
                </div>
            </div>
        </template>
    </div>

    @* --- Tab: Relations --- *@
    <div class="tab-pane" id="project-tab-relations" role="tabpanel">
        <div class="row">
            <div class="col-md-6"><div class="mb-3"><label asp-for="SelectedCategoryIds" class="form-label required"></label><select asp-for="SelectedCategoryIds" asp-items="@Model.CategoryList" class="form-select tom-select-multiple" multiple="multiple"></select><span asp-validation-for="SelectedCategoryIds" class="text-danger"></span><small class="form-hint">Chọn ít nhất một danh mục.</small></div></div>
            <div class="col-md-6"><div class="mb-3"><label asp-for="SelectedTagIds" class="form-label"></label><select asp-for="SelectedTagIds" asp-items="@Model.TagList" class="form-select tom-select-multiple" multiple="multiple" id="SelectedTagIds"></select><span asp-validation-for="SelectedTagIds" class="text-danger"></span><small class="form-hint">Chọn hoặc nhập thẻ mới.</small></div></div>
            <div class="col-12"><div class="mb-0"><label asp-for="SelectedProductIds" class="form-label"></label><select asp-for="SelectedProductIds" asp-items="@Model.ProductList" class="form-select tom-select-multiple" multiple="multiple" id="SelectedProductIds"></select><span asp-validation-for="SelectedProductIds" class="text-danger"></span><small class="form-hint">Chọn các sản phẩm đã sử dụng trong dự án.</small></div></div>
        </div>
    </div>

    @* --- Tab: SEO --- *@
    <div class="tab-pane" id="project-tab-seo" role="tabpanel">
        @* --- PASTE Standard SEO Fields Here (from _ArticleFormFields or _BrandFormFields) --- *@
        <h3 class="card-title mb-3">Tối ưu SEO</h3>
        <div class="mb-3"><label asp-for="MetaTitle" class="form-label"></label><input asp-for="MetaTitle" class="form-control" /><span asp-validation-for="MetaTitle" class="text-danger"></span><small class="form-hint">Tiêu đề SEO (tối ưu < 60 ký tự).</small></div>
        <div class="mb-3"><label asp-for="MetaDescription" class="form-label"></label><textarea asp-for="MetaDescription" class="form-control" rows="3"></textarea><span asp-validation-for="MetaDescription" class="text-danger"></span><small class="form-hint">Mô tả SEO (tối ưu < 160 ký tự).</small></div>
        <div class="mb-3"><label asp-for="MetaKeywords" class="form-label"></label><input asp-for="MetaKeywords" class="form-control" /><span asp-validation-for="MetaKeywords" class="text-danger"></span><small class="form-hint">Từ khóa SEO (cách nhau bởi dấu phẩy).</small></div>
        <hr class="my-3" />
        <div class="mb-3"><label asp-for="CanonicalUrl" class="form-label"></label><input asp-for="CanonicalUrl" class="form-control" type="url" /><span asp-validation-for="CanonicalUrl" class="text-danger"></span><small class="form-hint">URL gốc nếu trùng nội dung.</small></div>
        <div class="row mb-3"><div class="col-auto"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" asp-for="NoIndex" role="switch" id="seoNoIndexSwitch"><label class="form-check-label" asp-for="NoIndex"></label></div><small class="form-hint d-block ms-4 ps-2">Ngăn index.</small></div><div class="col-auto"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" asp-for="NoFollow" role="switch" id="seoNoFollowSwitch"><label class="form-check-label" asp-for="NoFollow"></label></div><small class="form-hint d-block ms-4 ps-2">Ngăn follow link.</small></div></div>
        <hr class="my-3" />
        <h4 class="mb-3">Open Graph (Mạng xã hội)</h4>
        <div class="mb-3"><label asp-for="OgTitle" class="form-label"></label><input asp-for="OgTitle" class="form-control" /><span asp-validation-for="OgTitle" class="text-danger"></span></div>
        <div class="mb-3"><label asp-for="OgDescription" class="form-label"></label><textarea asp-for="OgDescription" class="form-control" rows="2"></textarea><span asp-validation-for="OgDescription" class="text-danger"></span></div>
        <div class="mb-3"> <label asp-for="OgImage" class="form-label"></label> <div class="input-group"> <input type="text" asp-for="OgImage" class="form-control" id="ogImagePathInput" placeholder="URL hoặc MinIO Path" /> <button class="btn btn-outline-secondary select-media-btn" type="button" data-target-input="#ogImagePathInput" data-target-preview="#ogImagePreview" title="Chọn ảnh"><i class="ti ti-photo-search"></i></button> <button class="btn btn-outline-danger remove-media-btn @(string.IsNullOrEmpty(Model.OgImage) ? "d-none" : "")" type="button" data-target-input="#ogImagePathInput" data-target-preview="#ogImagePreview" data-placeholder="/img/placeholder.svg" title="Xóa"><i class="ti ti-x"></i></button> </div> <span asp-validation-for="OgImage" class="text-danger"></span> <img id="ogImagePreview" src="@(Model.OgImage?.StartsWith("http") ?? false ? Model.OgImage : MediaUrlHelper.GetMinioUrl(Model.OgImage, "/img/placeholder.svg"))" class="img-thumbnail mt-2" style="max-height: 80px; display: @(string.IsNullOrEmpty(Model.OgImage) ? "none" : "block");" /> <small class="form-hint">Ảnh tỷ lệ 1.91:1.</small> </div>
        <div class="mb-3"><label asp-for="OgType" class="form-label"></label><input asp-for="OgType" class="form-control" /><span asp-validation-for="OgType" class="text-danger"></span></div>
        <hr class="my-3" />
        <h4 class="mb-3">Cấu hình Sitemap</h4>
        <div class="row"><div class="col-md-6"><div class="mb-3"><label asp-for="SitemapPriority" class="form-label"></label><input type="number" asp-for="SitemapPriority" class="form-control" step="0.1" min="0.0" max="1.0" /><span asp-validation-for="SitemapPriority" class="text-danger"></span></div></div><div class="col-md-6"><div class="mb-3"><label asp-for="SitemapChangeFrequency" class="form-label required"></label><select asp-for="SitemapChangeFrequency" class="form-select tom-select-single"><option value="always">Always</option><option value="hourly">Hourly</option><option value="daily">Daily</option><option value="weekly">Weekly</option><option value="monthly">Monthly</option><option value="yearly">Yearly</option><option value="never">Never</option></select><span asp-validation-for="SitemapChangeFrequency" class="text-danger"></span></div></div></div>
        @* Add Twitter/Schema/Breadcrumb fields as needed *@
    </div>
</div>