@using shared.Helpers
@using web.Areas.Admin.ViewModels.Project
@model ProjectViewModel
@{
    ViewData["Title"] = "Thêm Dự án mới - Hệ thống quản trị";
}

@section Styles {
 <style>/* Add specific styles from Product Create */</style>
 }

<form asp-action="Create" method="post" id="project-form">
    <div class="card">
        <div class="card-header"><h3 class="card-title">Thông tin Dự án</h3></div>
        <div class="card-body">
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger mb-3"></div>
            <partial name="_ProjectFormFields" model="Model" />
        </div>
        <div class="card-footer text-end bg-transparent border-top pt-3">
            <a asp-action="Index" class="btn btn-link">Hủy</a>
            <button type="submit" class="btn btn-primary ms-2"><i class="ti ti-device-floppy me-2"></i> Lưu Dự án</button>
        </div>
    </div>
</form>
@section Scripts {
    <script src="~/js/slug.js" asp-append-version="true"></script>
    <script>
        $(document).ready(function() {
            // --- Initialize Plugins ---
            $('.tom-select-single').each(function() { new TomSelect(this, { create: false, placeholder: this.options[0].text || 'Chọn...' }); });
            $('.tom-select-multiple').each(function() { new TomSelect(this, { plugins: ['remove_button'], create: $(this).is('#SelectedTagIds'), placeholder: 'Chọn...' }); });
            $('.summernote-editor').summernote({ lang: 'vi-VN', height: 250, toolbar: [ ['style', ['style']], ['font', ['bold', 'italic', 'underline', 'clear']], ['para', ['ul', 'ol', 'paragraph']], ['insert', ['link', 'picture']], ['view', ['fullscreen', 'codeview', 'help']] ] });
             $('#projectContentEditor').summernote('height', 400); // Taller editor for main content

            // --- Slug Generation ---
            const titleInput = $('#projectName'); const slugInput = $('#projectSlug'); const generateBtn = $('#generateSlugButton');
            titleInput.on('input', function() { if (slugInput.val() === '') { slugInput.val(generateVietnameseSlug(titleInput.val())); } });
            generateBtn.on('click', function() { slugInput.val(generateVietnameseSlug(titleInput.val())); });

            // --- General Media Selection ---
            function handleMediaSelection(selectedFile, inputSelector, previewSelector) { /* ... (Same as Edit view JS) ... */
                 if (selectedFile && inputSelector && previewSelector) {
                     const inputField = $(inputSelector); const previewImg = $(previewSelector); const removeBtn = $(`button[data-target-input="${inputSelector}"]`).filter('.remove-media-btn');
                     const valueToStore = (inputSelector === '#ogImagePathInput' || inputSelector === '#twitterImagePathInput') ? selectedFile.url : selectedFile.path;
                     // Use path for generating preview URL, store path or URL based on input target
                     const displayUrl = '@(MediaUrlHelper.GetMinioUrl("__PATH__", "/img/placeholder.svg"))'.replace('__PATH__', selectedFile.path);
                     previewImg.attr('src', displayUrl).show();
                     inputField.val(valueToStore || '').trigger('change');
                     if(removeBtn.length) removeBtn.removeClass('d-none');
                 }
            }
             $(document).on('click', '.select-media-btn', function() { /* ... (Same as Edit view JS) ... */
                  const targetInput = $(this).data('target-input'); const targetPreview = $(this).data('target-preview');
                 if (typeof window.openMediaSelectionModal === 'function') { const cb = (sf) => handleMediaSelection(sf, targetInput, targetPreview); window.openMediaSelectionModal(cb, 'Image'); } else { console.error('openMediaSelectionModal is not defined.'); }
             });
              $(document).on('click', '.remove-media-btn', function() { /* ... (Same as Edit view JS) ... */
                  const targetInput = $(this).data('target-input'); const targetPreview = $(this).data('target-preview'); const placeholder = $(this).data('placeholder') || '/img/placeholder.svg';
                 if (targetInput && targetPreview) { $(targetPreview).attr('src', placeholder); if ($(targetPreview).is('#ogImagePreview')) $(targetPreview).hide(); $(targetInput).val('').trigger('change'); $(this).addClass('d-none'); }
              });

              // Initialize visibility for OG image preview
              if ($('#ogImagePathInput').val() === '') $('#ogImagePreview').hide(); else $('#ogImagePreview').show();
              // Add similar for Twitter if used
        });
    </script>
}            