@using shared.Enums
@using web.Areas.Admin.ViewModels.Article
@model ArticleViewModel

<div class="row">
    <div class="col-lg-8">
        <!-- Main content -->
        <div class="card">
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="Title" class="form-label required">Tiêu đề</label>
                    <input asp-for="Title" class="form-control" id="articleTitle" />
                    <span asp-validation-for="Title" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Slug" class="form-label required">Slug</label>
                    <div class="input-group">
                        <input asp-for="Slug" class="form-control" id="articleSlug" />
                        <button class="btn btn-outline-secondary" type="button" id="generateSlug">
                            <i class="fas fa-sync-alt"></i> Tạo slug
                        </button>
                    </div>
                    <span asp-validation-for="Slug" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Summary" class="form-label">Tóm tắt</label>
                    <textarea asp-for="Summary" class="form-control" rows="3"></textarea>
                    <span asp-validation-for="Summary" class="text-danger"></span>
                    <small class="form-hint">Tóm tắt ngắn gọn về bài viết (tối đa 500 ký tự)</small>
                </div>

                <div class="mb-3">
                    <label asp-for="Content" class="form-label required">Nội dung</label>
                    <textarea asp-for="Content" class="form-control summernote" id="editor" rows="15"></textarea>
                    <span asp-validation-for="Content" class="text-danger"></span>
                </div>
            </div>
        </div>

        <!-- SEO -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Thông tin SEO</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="MetaTitle" class="form-label">Meta Title</label>
                    <input asp-for="MetaTitle" class="form-control" />
                    <span asp-validation-for="MetaTitle" class="text-danger"></span>
                    <small class="form-hint">Để trống để sử dụng tiêu đề bài viết</small>
                </div>

                <div class="mb-3">
                    <label asp-for="MetaDescription" class="form-label">Meta Description</label>
                    <textarea asp-for="MetaDescription" class="form-control" rows="2"></textarea>
                    <span asp-validation-for="MetaDescription" class="text-danger"></span>
                    <small class="form-hint">Để trống để sử dụng tóm tắt bài viết</small>
                </div>

                <div class="mb-3">
                    <label asp-for="MetaKeywords" class="form-label">Meta Keywords</label>
                    <input asp-for="MetaKeywords" class="form-control" />
                    <span asp-validation-for="MetaKeywords" class="text-danger"></span>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input asp-for="NoIndex" class="form-check-input" type="checkbox" />
                            <label asp-for="NoIndex" class="form-check-label">Không đánh chỉ mục (noindex)</label>
                            <small class="form-hint d-block">Ngăn công cụ tìm kiếm đánh chỉ mục trang này</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-check form-switch mb-3">
                            <input asp-for="NoFollow" class="form-check-input" type="checkbox" />
                            <label asp-for="NoFollow" class="form-check-label">Không theo dõi liên kết (nofollow)</label>
                            <small class="form-hint d-block">Ngăn công cụ tìm kiếm theo dõi các liên kết trên trang này</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Sản phẩm liên quan</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <select id="productSelect" class="form-select">
                        <option value="">Chọn sản phẩm liên quan...</option>
                        @foreach (var product in Model.AvailableProducts)
                        {
                            <option value="@product.Id" selected="@(product.Selected ? "selected" : "")">@product.Name</option>
                        }
                    </select>
                    <div id="selectedProducts" class="mt-3">
                        @foreach (var productId in Model.ProductIds)
                        {
                            var product = Model.AvailableProducts.FirstOrDefault(p => p.Id == productId);
                            if (product != null)
                            {
                                <input type="hidden" name="ProductIds" value="@product.Id" />
                                <div class="selected-item" data-id="@product.Id">
                                    <span>@product.Name</span>
                                    <button type="button" class="btn btn-sm btn-icon remove-item">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <!-- Publish settings -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Xuất bản</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="Status" class="form-label">Trạng thái</label>
                    <select asp-for="Status" class="form-select">
                        <option value="@PublishStatus.Draft">Nháp</option>
                        <option value="@PublishStatus.Published">Xuất bản</option>
                        <option value="@PublishStatus.Scheduled">Lên lịch</option>
                    </select>
                    <span asp-validation-for="Status" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="PublishedAt" class="form-label">Ngày xuất bản</label>
                    <input asp-for="PublishedAt" type="datetime" class="form-control" />
                    <span asp-validation-for="PublishedAt" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="Type" class="form-label">Loại bài viết</label>
                    <select asp-for="Type" class="form-select">
                        <option value="@ArticleType.Knowledge">Kiến thức</option>
                        <option value="@ArticleType.News">Tin tức</option>
                        <option value="@ArticleType.Tutorial">Hướng dẫn</option>
                    </select>
                    <span asp-validation-for="Type" class="text-danger"></span>
                </div>

                <div class="form-check form-switch mb-3">
                    <input asp-for="IsFeatured" class="form-check-input" type="checkbox" />
                    <label asp-for="IsFeatured" class="form-check-label">Bài viết nổi bật</label>
                    <small class="form-hint d-block">Bài viết sẽ được hiển thị ở vị trí nổi bật trên trang chủ</small>
                </div>

                <div class="mb-3">
                    <label asp-for="EstimatedReadingMinutes" class="form-label">Thời gian đọc (phút)</label>
                    <input asp-for="EstimatedReadingMinutes" type="number" class="form-control" min="1" />
                    <span asp-validation-for="EstimatedReadingMinutes" class="text-danger"></span>
                    <small class="form-hint">Để trống để tự động tính toán</small>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i> Quay lại
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i> @(Model.Id > 0 ? "Cập nhật" : "Lưu")
                    </button>
                </div>
            </div>
        </div>

        <!-- Categories and Tags -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Danh mục & Thẻ</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label required">Danh mục</label>
                    <div class="category-list">
                        @foreach (var category in Model.AvailableCategories)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="CategoryIds" value="@category.Id" id="category-@category.Id" @(category.Selected ? "checked" : "")>
                                <label class="form-check-label" for="category-@category.Id">
                                    @category.Name
                                </label>
                            </div>
                        }
                    </div>
                    <span asp-validation-for="CategoryIds" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label class="form-label">Thẻ</label>
                    <select id="tagSelect" class="form-select">
                        <option value="">Chọn thẻ...</option>
                        @foreach (var tag in Model.AvailableTags)
                        {
                            <option value="@tag.Id" selected="@(tag.Selected ? "selected" : "")">@tag.Name</option>
                        }
                    </select>
                    <div id="selectedTags" class="mt-3">
                        @foreach (var tagId in Model.TagIds)
                        {
                            var tag = Model.AvailableTags.FirstOrDefault(t => t.Id == tagId);
                            if (tag != null)
                            {
                                <input type="hidden" name="TagIds" value="@tag.Id" />
                                <div class="selected-item" data-id="@tag.Id">
                                    <span>@tag.Name</span>
                                    <button type="button" class="btn btn-sm btn-icon remove-item">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Images -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Hình ảnh</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="FeaturedImageFile" class="form-label">Ảnh đại diện</label>
                    <input asp-for="FeaturedImageFile" type="file" class="form-control" accept="image/*" />
                    <span asp-validation-for="FeaturedImageFile" class="text-danger"></span>

                    @if (!string.IsNullOrEmpty(Model.FeaturedImage))
                    {
                        <div class="mt-2">
                            <img src="@Model.FeaturedImage" class="img-thumbnail" style="max-height: 150px;" />
                            <input type="hidden" asp-for="FeaturedImage" />
                        </div>
                    }
                </div>

                <div class="mb-3">
                    <label asp-for="ThumbnailImageFile" class="form-label">Ảnh thumbnail</label>
                    <input asp-for="ThumbnailImageFile" type="file" class="form-control" accept="image/*" />
                    <span asp-validation-for="ThumbnailImageFile" class="text-danger"></span>

                    @if (!string.IsNullOrEmpty(Model.ThumbnailImage))
                    {
                        <div class="mt-2">
                            <img src="@Model.ThumbnailImage" class="img-thumbnail" style="max-height: 150px;" />
                            <input type="hidden" asp-for="ThumbnailImage" />
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Author Info -->
        <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Thông tin tác giả</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="AuthorName" class="form-label">Tên tác giả</label>
                    <input asp-for="AuthorName" class="form-control" />
                    <span asp-validation-for="AuthorName" class="text-danger"></span>
                </div>

                <div class="mb-3">
                    <label asp-for="AuthorAvatar" class="form-label">Avatar URL</label>
                    <input asp-for="AuthorAvatar" class="form-control" />
                    <span asp-validation-for="AuthorAvatar" class="text-danger"></span>
                </div>

                <input type="hidden" asp-for="AuthorId" />
            </div>
        </div>
    </div>
</div>

