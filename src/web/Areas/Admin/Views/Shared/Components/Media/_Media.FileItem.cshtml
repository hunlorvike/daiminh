@using shared.Enums
@model MediaFileViewModel
@{
    bool isInModal = ViewData.TryGetValue("IsInModal", out var value) && value is bool boolValue && boolValue;
    string cardClasses = isInModal ? "card card-sm h-100" : "card h-100";
    string imageWrapperClass = "ratio ratio-1x1 d-flex align-items-center justify-content-center";
    string imageStyle = $"background-image: url('{(!string.IsNullOrEmpty(Model.PresignedUrl) ? Model.PresignedUrl : "/img/placeholder.svg")}'); background-size: cover; background-position: center;";
    string iconFontSize = isInModal ? "fs-2" : "fs-1";
    string cardBodyPadding = isInModal ? "p-2" : "p-3";
    string titleClass = isInModal ? "small" : "fw-medium";
}

<div class="col">
    <div class="@cardClasses media-file-item"
         data-file-id="@Model.Id"
         data-file-url="@Model.PresignedUrl" 
         data-file-alt="@Model.AltText"
         data-file-name="@Model.OriginalFileName"
         data-file-type="@Model.MediaType.ToString().ToLower()"
         data-bs-toggle="tooltip" data-bs-placement="bottom" title="@Model.OriginalFileName (@Model.FormattedFileSize)">
        <div class="card-img-top @imageWrapperClass @(Model.MediaType != MediaType.Image ? "bg-light-subtle" : "")"
             style="@(Model.MediaType == MediaType.Image && !string.IsNullOrEmpty(Model.PresignedUrl) ? imageStyle : "")">
            @if (Model.MediaType != MediaType.Image)
            {
                <i class="ti @(Model.MediaType == MediaType.Video ? "ti-video" : (Model.MediaType == MediaType.Document ? "ti-file-text" : "ti-file")) @iconFontSize text-muted"></i>
            }
        </div>
        <div class="card-body @cardBodyPadding text-center">
            <div class="text-truncate @titleClass mb-1" title="@Model.OriginalFileName">@Model.OriginalFileName</div>
            <div class="text-muted small">@Model.FormattedFileSize</div>
            @if (Model.MediaType == MediaType.Video && Model.Duration.HasValue)
            {
                <div class="text-muted small">@Model.Duration.Value giây</div>
            }
        </div>
        @if (!isInModal)
        {
            <div class="card-footer p-2">
                <div class="btn-list justify-content-center flex-nowrap">
                    <a asp-action="Edit" asp-controller="Media" asp-route-id="@Model.Id" class="btn btn-sm btn-ghost-secondary" title="Sửa thông tin">
                        <i class="ti ti-pencil"></i>
                    </a>
                    <button class="btn btn-sm btn-ghost-danger delete-file-btn" data-id="@Model.Id" data-name="@Model.OriginalFileName" title="Xóa" data-delete-url="@Url.Action("DeleteFile", "Media")">
                        <i class="ti ti-trash"></i>
                    </button>
                </div>
            </div>
        }
    </div>
</div>