@using web.Areas.Admin.ViewModels.FAQ
@model FAQViewModel
@{
	ViewData["Title"] = "Thêm câu hỏi - Hệ thống quản trị";
}

<div class="card">
	<div class="card-body">
		<form asp-action="Create" method="post">
			<div asp-validation-summary="ModelOnly" class="text-danger"></div>
			<div class="row mb-3">
				<div class="col-md-8">
					<div class="form-group mb-3">
						<label asp-for="Question" class="form-label required">Câu hỏi</label>
						<input asp-for="Question" class="form-control" />
						<span asp-validation-for="Question" class="text-danger"></span>
					</div>

					<div class="form-group mb-3">
						<label asp-for="Answer" class="form-label required">Câu trả lời</label>
						<textarea asp-for="Answer" class="form-control summernote" rows="10"></textarea>
						<span asp-validation-for="Answer" class="text-danger"></span>
					</div>
				</div>

				<div class="col-md-4">
					<div class="form-group mb-3">
						<label asp-for="CategoryId" class="form-label required">Danh mục</label>
						<select asp-for="CategoryId" class="form-select">
							<option value="">-- Chọn danh mục --</option>
							@if (Model.Categories != null)
							{
								@foreach (var category in Model.Categories)
								{
									<option value="@category.Id">@category.Name</option>
								}
							}
						</select>
						<span asp-validation-for="CategoryId" class="text-danger"></span>
						<small class="form-hint">
							Nếu chưa có danh mục phù hợp, <a asp-controller="FAQCategory" asp-action="Create"
								target="_blank">hãy tạo danh mục mới</a>
						</small>
					</div>

					<div class="form-group mb-3">
						<label asp-for="OrderIndex" class="form-label">Thứ tự hiển thị</label>
						<input asp-for="OrderIndex" class="form-control" type="number" min="0" />
						<span asp-validation-for="OrderIndex" class="text-danger"></span>
						<small class="form-hint">Số thấp hơn sẽ hiển thị trước</small>
					</div>

					<div class="form-group mb-3">
						<div class="form-check form-switch">
							<input asp-for="IsActive" class="form-check-input" type="checkbox" />
							<label asp-for="IsActive" class="form-check-label">Hiển thị câu hỏi</label>
						</div>
						<span asp-validation-for="IsActive" class="text-danger"></span>
					</div>
				</div>
			</div>

			<div class="d-flex justify-content-between mt-4">
				<a asp-action="Index" class="btn btn-outline-secondary">
					<i class="fas fa-arrow-left me-2"></i> Quay lại
				</a>
				<button type="submit" class="btn btn-primary">
					<i class="fas fa-save me-2"></i> Lưu câu hỏi
				</button>
			</div>
		</form>
	</div>
</div>

@section Scripts {
	<script>
		function onImageSelected(data) {
			if (data && data.url) {
				$('.summernote').summernote('insertImage', data.url, data.filename);
			}
		}
		$(document).ready(function () {
			$('.summernote').summernote({
				placeholder: 'Nhập nội dung của bạn ở đây...',
				tabsize: 2,
				height: 300,
				lang: 'vi-VN',
				toolbarContainer: '.note-toolbar',
				toolbar: [
					['style', ['style']],
					['font', ['bold', 'underline', 'clear']],
					['fontname', ['fontname']],
					['color', ['color']],
					['para', ['ul', 'ol', 'paragraph']],
					['table', ['table']],
					['insert', ['link', 'video']],
					['view', ['fullscreen', 'codeview', 'help']],
					['fontsize', ['fontsize']],
					['height', ['height']],
					['misc', ['undo', 'redo']],
					['format', ['strikethrough', 'superscript', 'subscript']],
					['hr', ['hr']],
					['custom', ['mediaBrowser']]
				],
				buttons: {
					mediaBrowser: function (context) {
						var ui = $.summernote.ui;
						var button = ui.button({
							contents: '<i class="note-icon-picture"></i>',
							tooltip: 'Chọn ảnh từ thư viện',
							click: function () {
								openMediaBrowser('onImageSelected', 'image');
							}
						});
						return button.render();
					}
				},
				popover: {
					image: [
						['image', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],
						['float', ['floatLeft', 'floatRight', 'floatNone']],
						['remove', ['removeMedia']]
					],
					link: [
						['link', ['linkDialogShow', 'unlink']]
					],
					table: [
						['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],
						['delete', ['deleteRow', 'deleteCol', 'deleteTable']]
					],
					air: [
						['color', ['color']],
						['font', ['bold', 'underline', 'clear']],
						['para', ['ul', 'paragraph']],
						['table', ['table']],
						['insert', ['link', 'picture']]
					]
				}
			});

			$('<style>.note-toolbar { display: flex; flex-wrap: wrap; } .note-toolbar > .note-btn-group { margin-bottom: 5px; }</style>').appendTo('head');
		});
	</script>
}
