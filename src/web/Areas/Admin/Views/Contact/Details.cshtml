@using web.Areas.Admin.ViewModels.Contact
@model ContactViewModel
@{
    ViewData["Title"] = $"Chi tiết Liên hệ: {Model.Subject}";
    ViewData["PageTitle"] = "Chi tiết Liên hệ";
    ViewData["Breadcrumbs"] = new List<(string Text, string Url)> {
        ("Liên hệ", Url.Action(nameof(Index)) ?? "/Admin/Contact"),
        (Model.Subject, "")
    };
}

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Nội dung Liên hệ</h3>
             </div>
            <div class="card-body">
                <dl class="row">
                     <dt class="col-sm-3">Người gửi:</dt>
                     <dd class="col-sm-9">@Model.FullName</dd>

                     <dt class="col-sm-3">Email:</dt>
                     <dd class="col-sm-9"><a href="mailto:@Model.Email">@Model.Email</a></dd>

                     @if (!string.IsNullOrEmpty(Model.Phone))
                     {
                        <dt class="col-sm-3">Điện thoại:</dt>
                        <dd class="col-sm-9"><a href="tel:@Model.Phone">@Model.Phone</a></dd>
                     }

                     <dt class="col-sm-3">Chủ đề:</dt>
                     <dd class="col-sm-9">@Model.Subject</dd>

                     <dt class="col-sm-3">Nội dung:</dt>
                     <dd class="col-sm-9"><div style="white-space: pre-wrap;">@Model.Message</div></dd>
                </dl>
            </div>
        </div>

         <div class="card mt-3">
            <div class="card-header">
                <h3 class="card-title">Thông tin Kỹ thuật</h3>
             </div>
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-3">Ngày gửi:</dt>
                    <dd class="col-sm-9" title="@Model.CreatedAt.ToString("F")">@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")</dd>

                    @if (!string.IsNullOrEmpty(Model.IpAddress))
                     {
                        <dt class="col-sm-3">Địa chỉ IP:</dt>
                        <dd class="col-sm-9">@Model.IpAddress</dd>
                     }
                     @if (!string.IsNullOrEmpty(Model.UserAgent))
                     {
                         <dt class="col-sm-3">User Agent:</dt>
                        <dd class="col-sm-9"><small>@Model.UserAgent</small></dd>
                     }
                </dl>
            </div>
         </div>

    </div>
    <div class="col-md-4">
        <div class="card">
             <div class="card-header">
                <h3 class="card-title">Cập nhật Trạng thái & Ghi chú</h3>
             </div>
             <form asp-action="UpdateDetails" asp-route-id="@Model.Id" method="post">
                 @Html.AntiForgeryToken()
                 <input type="hidden" asp-for="Id" />
                 <div class="card-body">
                     <div asp-validation-summary="ModelOnly" class="text-danger alert alert-danger mb-3"></div>

                     <div class="mb-3">
                         <label asp-for="Status" class="form-label required"></label>
                         <select asp-for="Status" asp-items="Model.StatusOptions" class="form-select"></select>
                         <span asp-validation-for="Status" class="text-danger"></span>
                     </div>
                     <div class="mb-0">
                         <label asp-for="AdminNotes" class="form-label"></label>
                         <textarea asp-for="AdminNotes" class="form-control" rows="5"></textarea>
                         <span asp-validation-for="AdminNotes" class="text-danger"></span>
                     </div>
                 </div>
                 <div class="card-footer text-end">
                      <button type="submit" class="btn btn-primary">
                        <i class="ti ti-device-floppy me-2"></i> Lưu thay đổi
                    </button>
                 </div>
            </form>
        </div>

        <div class="mt-3 d-flex justify-content-between">
             <a asp-action="Index" class="btn btn-outline-secondary">
                <i class="ti ti-arrow-left me-2"></i> Quay lại Danh sách
             </a>
              <button class="btn btn-outline-danger delete-item-btn"
                      title="Xóa liên hệ này"
                      data-id="@Model.Id"
                      data-name="@($"liên hệ từ {Model.FullName} về '{Model.Subject}'")"
                      data-delete-url="@Url.Action("Delete", "Contact")"
                      data-redirect-url="@Url.Action("Index", "Contact")">
                <i class="ti ti-trash me-2"></i> Xóa Liên hệ
            </button>
        </div>
    </div>
</div>

