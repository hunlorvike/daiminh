@* --- START OF FILE Views/Project/Index.cshtml --- (New File) *@
@using X.PagedList.Mvc.Core
@using X.PagedList
@using web.ViewModels.Project // Use public VM namespace
@using shared.Helpers // For MediaUrlHelper
@model IPagedList<ProjectListItemViewModel>
@{
    // Title is set in Controller
    ViewData["BodyClass"] = "project-list-page"; // Optional: Add body class for specific styling
    var currentCategorySlug = ViewBag.CurrentCategorySlug as string;
    var categoryName = ViewData["CategoryName"] as string;
}

@section Styles {
    <style>
        .project-card .card-img-top {
            height: 200px; /* Adjust as needed */
            object-fit: cover;
        }

        .project-card .card-title {
            min-height: 2.5em; /* Prevent title height jumps */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .project-card .card-text {
            min-height: 4.5em; /* Approx 3 lines */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .category-filter .nav-link.active {
            font-weight: bold;
            background-color: var(--tblr-primary-lt); /* Example active style */
        }
    </style>
}

<div class="page-header">@* Optional Page Header *@
    <div class="container">
        <h1 class="page-title">
            @if (!string.IsNullOrEmpty(categoryName))
            {
                <small class="text-muted">Dự án:</small> @categoryName
            }
            else
            {
                @ViewData["Title"]
            }
        </h1>
        @* Optional: Breadcrumbs here *@
    </div>
</div>

<div class="page-body">
    <div class="container">
        @* Optional: Category Filter Tabs/Links *@
        @if (ViewBag.Categories != null)
        {
            <ul class="nav nav-pills justify-content-center mb-4 category-filter">
                <li class="nav-item">
                    <a class="nav-link @(string.IsNullOrEmpty(currentCategorySlug) ? "active" : "")" asp-action="Index" asp-route-categorySlug="">Tất cả Dự án</a>
                </li>
                @foreach (SelectListItem category in ViewBag.Categories)
                {
                    <li class="nav-item">
                        <a class="nav-link @(category.Value == currentCategorySlug ? "active" : "")" asp-action="Index" asp-route-categorySlug="@category.Value">@category.Text</a>
                    </li>
                }
            </ul>
        }

        @if (!Model.Any())
        {
            <div class="alert alert-info text-center" role="alert">
                Không tìm thấy dự án nào@(string.IsNullOrEmpty(categoryName) ? "." : $" trong danh mục '{categoryName}'.")
            </div>
        }
        else
        {
            <div class="row row-cards g-4">
                @* Grid layout *@
                @foreach (var project in Model)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="card project-card h-100">
                            @* Add h-100 for equal height cards *@
                            <a asp-action="Details" asp-route-slug="@project.Slug">
                                <img src="@MediaUrlHelper.GetMinioUrl(project.ThumbnailOrFeaturedImageUrl, "/img/placeholder.svg")" alt="@project.Name" class="card-img-top">
                            </a>
                            <div class="card-body d-flex flex-column">
                                @* Flex column for button at bottom *@
                                <h3 class="card-title">
                                    <a asp-action="Details" asp-route-slug="@project.Slug">@project.Name</a>
                                </h3>
                                @if (!string.IsNullOrEmpty(project.PrimaryCategoryName) && !string.IsNullOrEmpty(project.PrimaryCategorySlug))
                                {
                                    <div class="text-muted mb-1">
                                        <a asp-action="Index" asp-route-categorySlug="@project.PrimaryCategorySlug" class="text-reset">@project.PrimaryCategoryName</a>
                                    </div>
                                }
                                <p class="card-text text-muted">@project.ShortDescription</p>
                                <div class="mt-auto">
                                    @* Push button to bottom *@
                                    <a asp-action="Details" asp-route-slug="@project.Slug" class="btn btn-outline-primary w-100">Xem chi tiết</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @* Pagination *@
            <div class="mt-4 d-flex justify-content-center">
                @Html.PagedListPager(Model, page => Url.Action("Index", new { page, categorySlug = currentCategorySlug }), new PagedListRenderOptions
       {
           UlElementClasses = new[] { "pagination mb-0" },
           LiElementClasses = new[] { "page-item" },
           PageClasses = new[] { "page-link" },
           DisplayLinkToFirstPage = PagedListDisplayMode.IfNeeded,
           DisplayLinkToLastPage = PagedListDisplayMode.IfNeeded,
           DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
           DisplayLinkToNextPage = PagedListDisplayMode.Always,
       })))
            </div>
        }
    </div>
</div>
@* --- END OF FILE Views/Project/Index.cshtml --- *@