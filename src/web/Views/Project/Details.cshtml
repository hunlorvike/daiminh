@* --- START OF FILE Views/Project/Details.cshtml --- (New File) *@
@using web.ViewModels.Project
@using shared.Helpers
@using shared.Enums
@using shared.Extensions // For GetDisplayName
@model ProjectDetailViewModel
@{
    // Title and Meta tags are set in the Controller using ViewData
    ViewData["BodyClass"] = "project-detail-page";
    var featuredImageUrl = MediaUrlHelper.GetMinioUrl(Model.FeaturedImage);
}

@section Head { @* Add SEO meta tags to head *@
    <meta name="description" content="@ViewData["MetaDescription"]">
    <meta name="keywords" content="@ViewData["MetaKeywords"]">
    <link rel="canonical" href="@ViewData["CanonicalUrl"]">
    @* Add OG/Twitter tags here using Model properties (resolve OgImage/TwitterImage URL) *@
    <meta property="og:title" content="@(Model.OgTitle ?? ViewData["Title"])" />
    <meta property="og:description" content="@(Model.OgDescription ?? ViewData["MetaDescription"])" />
    <meta property="og:type" content="@(Model.OgType ?? "article")" />
    @if (!string.IsNullOrWhiteSpace(Model.OgImage)) { <meta property="og:image" content="@(Model.OgImage.StartsWith("http") ? Model.OgImage : MediaUrlHelper.GetMinioUrl(Model.OgImage))" /> }
    else if (!string.IsNullOrWhiteSpace(featuredImageUrl)) { <meta property="og:image" content="@featuredImageUrl" /> }
    <meta property="og:url" content="@ViewData["CanonicalUrl"]" />
    @* Add Twitter card meta tags similarly *@
}

@section Styles {
    @* Add styles for gallery/lightbox if needed *@
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/css/lightbox.min.css" />
    <style>
        .project-featured-image img { max-height: 500px; width: 100%; object-fit: cover; }
        .project-gallery img { height: 150px; object-fit: cover; cursor: pointer; }
        .project-details-sidebar dt { font-weight: 600; }
        .project-details-sidebar dd { margin-bottom: 0.75rem; }
        .related-product-card img { height: 100px; object-fit: contain; background-color: #f8f9fa; }
    </style>
}

<div class="page-header page-header-bleed"> @* Full-width header option *@
    <div class="container">
        @* Optional Breadcrumbs *@
         <ol class="breadcrumb breadcrumb-arrows" aria-label="breadcrumbs">
            <li class="breadcrumb-item"><a href="/">Trang chủ</a></li>
            <li class="breadcrumb-item"><a asp-action="Index">Dự án</a></li>
             @if (Model.Categories.Any()) {
                 var firstCat = Model.Categories.First();
                 <li class="breadcrumb-item"><a asp-action="Index" asp-route-categorySlug="@firstCat.Slug">@firstCat.Name</a></li>
             }
            <li class="breadcrumb-item active" aria-current="page"><a href="#">@Model.Name</a></li>
         </ol>
         <h1 class="page-title display-5 mt-2">@Model.Name</h1>
         @if(!string.IsNullOrWhiteSpace(Model.Client) || !string.IsNullOrWhiteSpace(Model.Location)) {
            <p class="text-muted">@Model.Client @(!string.IsNullOrWhiteSpace(Model.Client) && !string.IsNullOrWhiteSpace(Model.Location) ? " - " : "") @Model.Location</p>
         }
    </div>
</div>

<div class="page-body">
    <div class="container">
        <div class="row g-4">
            <div class="col-lg-8">
                @* Featured Image *@
                @if (!string.IsNullOrWhiteSpace(featuredImageUrl))
                {
                    <div class="card card-body mb-4 project-featured-image">
                         <a href="@featuredImageUrl" data-lightbox="project-gallery" data-title="@(Model.Name) - Ảnh đại diện">
                            <img src="@featuredImageUrl" alt="@(Model.Name) - Ảnh đại diện" class="img-fluid rounded">
                         </a>
                    </div>
                }

                @* Main Description *@
                <div class="card card-body mb-4">
                     <h2 class="card-title">Mô tả dự án</h2>
                     <div class="markdown"> @* Use markdown class if content is Markdown, otherwise remove *@
                         @Html.Raw(Model.Description) @* Assumes Description is safe HTML *@
                     </div>
                </div>

                 @* Image Gallery *@
                 @if (Model.GalleryImages.Any())
                 {
                     <div class="card card-body mb-4">
                         <h2 class="card-title">Hình ảnh dự án</h2>
                          <div class="row g-2 project-gallery">
                              @foreach (var img in Model.GalleryImages)
                              {
                                 var imgUrl = MediaUrlHelper.GetMinioUrl(img.ImageUrl);
                                 var thumbUrl = MediaUrlHelper.GetMinioUrl(img.ThumbnailUrl ?? img.ImageUrl, "/img/placeholder.svg");
                                 <div class="col-6 col-sm-4 col-md-3">
                                     <a href="@imgUrl" data-lightbox="project-gallery" data-title="@(img.Title ?? img.AltText ?? Model.Name)" data-description="@img.Description">
                                        <img src="@thumbUrl" alt="@(img.AltText ?? Model.Name)" class="img-fluid rounded shadow-sm">
                                     </a>
                                 </div>
                              }
                          </div>
                     </div>
                 }

                  @* Related Products *@
                 @if (Model.RelatedProducts.Any())
                 {
                     <div class="card card-body mb-4">
                         <h2 class="card-title">Sản phẩm sử dụng trong dự án</h2>
                         <div class="row g-3">
                             @foreach (var product in Model.RelatedProducts)
                             {
                                 <div class="col-md-6 col-lg-4">
                                     <div class="card related-product-card h-100">
                                         <a asp-controller="Product" asp-action="Details" asp-route-slug="@product.Slug">
                                             <img src="@MediaUrlHelper.GetMinioUrl(product.ImageUrl, "/img/placeholder.svg")" alt="@product.Name" class="card-img-top p-2">
                                         </a>
                                         <div class="card-body">
                                             <h4 class="card-title mb-1"><a asp-controller="Product" asp-action="Details" asp-route-slug="@product.Slug">@product.Name</a></h4>
                                             @if (!string.IsNullOrWhiteSpace(product.Usage)) {
                                                 <small class="text-muted d-block"><em>Sử dụng: @product.Usage</em></small>
                                             }
                                         </div>
                                     </div>
                                 </div>
                             }
                         </div>
                     </div>
                 }


            </div>
            <div class="col-lg-4">
                @* Sidebar Details *@
                <div class="card sticky-top">
                    <div class="card-header">
                         <h3 class="card-title mb-0">Thông tin chi tiết</h3>
                    </div>
                    <div class="card-body project-details-sidebar">
                         <dl class="row">
                            @if(!string.IsNullOrWhiteSpace(Model.Client)) { <dt class="col-5">Khách hàng:</dt> <dd class="col-7">@Model.Client</dd> }
                            @if(!string.IsNullOrWhiteSpace(Model.Location)) { <dt class="col-5">Địa điểm:</dt> <dd class="col-7">@Model.Location</dd> }
                            @if(Model.Area.HasValue) { <dt class="col-5">Diện tích:</dt> <dd class="col-7">@Model.Area?.ToString("N0") m²</dd> }
                            @if(Model.StartDate.HasValue) { <dt class="col-5">Bắt đầu:</dt> <dd class="col-7">@Model.StartDate?.ToString("dd/MM/yyyy")</dd> }
                            @if(Model.CompletionDate.HasValue) { <dt class="col-5">Hoàn thành:</dt> <dd class="col-7">@Model.CompletionDate?.ToString("dd/MM/yyyy")</dd> }
                            <dt class="col-5">Tình trạng:</dt> <dd class="col-7"><span class="badge bg-@(GetProjectStatusBadge(Model.Status))-lt">@Model.Status.GetDisplayName()</span></dd>

                             @if (Model.Categories.Any())
                             {
                                 <dt class="col-5">Danh mục:</dt>
                                 <dd class="col-7">
                                     @foreach (var cat in Model.Categories) { <a asp-action="Index" asp-route-categorySlug="@cat.Slug" class="badge bg-light text-dark me-1 mb-1">@cat.Name</a> }
                                 </dd>
                             }
                              @if (Model.Tags.Any())
                             {
                                 <dt class="col-5">Thẻ:</dt>
                                 <dd class="col-7">
                                     @foreach (var tag in Model.Tags) { <span class="badge bg-secondary-lt me-1 mb-1">@tag.Name</span> } 
                                 </dd>
                             }
                         </dl>
                         @* Optional: Social Share Buttons *@
                         @* <div class="mt-4 d-flex justify-content-center"> SHARE LINKS </div> *@
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@functions {
    string GetProjectStatusBadge(ProjectStatus status) => status switch { ProjectStatus.Planning => "secondary", ProjectStatus.InProgress => "primary", ProjectStatus.Completed => "success", ProjectStatus.OnHold => "warning", ProjectStatus.Cancelled => "danger", _ => "secondary" };
}

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.11.3/js/lightbox.min.js"></script>
    <script>
        // Optional: Lightbox configuration
        lightbox.option({
          'resizeDuration': 200,
          'wrapAround': true
        })
    </script>
}
@* --- END OF FILE Views/Project/Details.cshtml --- *@